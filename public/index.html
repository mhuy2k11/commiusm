<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loomian Effective Damage Check</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Include Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Include Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        async function loadLoomians() {
            try {
                const response1 = await fetch('loomians.json');
                const data1 = await response.json();
                const response2 = await fetch('effectiveness.json');
                const data2 = await response.json();
                
                const loomianList = document.getElementById("loomianList");
                const typeList = document.getElementById("typeList");

                // Sort Loomians by name (A to Z)
                const sortedLoomians = data1.loomians.sort((a, b) => a.name.localeCompare(b.name));

                // Populate the first dropdown with sorted Loomians
                sortedLoomians.forEach(loomian => {
                    const option = document.createElement("option");
                    option.value = loomian.types;
                    option.textContent = loomian.name;
                    loomianList.appendChild(option);
                });

                // Initialize Select2 for both dropdowns
                $('#loomianList').select2({
                    placeholder: "Search for a Loomian",
                    allowClear: true
                });

                $('#typeList').select2({
                    placeholder: "Choose attacking type",
                    allowClear: true
                });
            } catch (error) {
                console.log("Error loading Loomians:", error);
            }
        }

        // Function to get selected options
        function getSelectedOptions() {
            const loomianList = document.getElementById("loomianList");
            const typeList = document.getElementById("typeList");
            const output = document.getElementById("output");

            const selectedLoomian = loomianList.options[loomianList.selectedIndex]?.textContent || "None";
            const selectedType = typeList.options[typeList.selectedIndex]?.textContent || "None";



            output.textContent = `Selected Loomian: ${selectedLoomian}, Selected Type: ${selectedType}`;
        }

        // Ensure DOM is fully loaded before adding event listeners
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("getOptionsButton").addEventListener("click", getSelectedOptions);
            loadLoomians();
        });
    </script>
</head>

<body>
    <h1>Loomian Effective Damage Check</h1>
    <label for="loomianList">Choose the defending Loomian:</label>
    <select id="loomianList" style="width: 30%;">
        <!-- Options will be dynamically loaded here -->
    </select>
    <br>
    <label for="type">Choose attacking type:</label>
    <select id="typeList" style="width: 30%;">
        <option value="Fire">Fire</option>
        <option value="Metal">Metal</option>
        <option value="Water">Water</option>
        <option value="Light">Light</option>
        <option value="Plant">Plant</option>
        <option value="Brawler">Brawler</option>
        <option value="Dark">Dark</option>
        <option value="Spirit">Spirit</option>
        <option value="Ice">Ice</option>
        <option value="Earth">Earth</option>
        <option value="Electric">Electric</option>
        <option value="Ancient">Ancient</option>
        <option value="Simple">Simple</option>
        <option value="Bug">Bug</option>
        <option value="Air">Air</option>
        <option value="Toxic">Toxic</option>
        <option value="Mind">Mind</option>
    </select>
    <br><br>
    <button id="getOptionsButton">Check</button>
    <p id="output"></p>
</body>

</html>